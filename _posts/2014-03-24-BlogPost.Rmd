---
title: "Title: Bad Graph Critique and Improvement"
author: "Name: Steven Royce"
date: "Date: 03/23/2015"
layout: post
output: html_document
---

___
# Bad Graph Critique  
The infographics below illustrates the difference between the death tolls of diseases and the money raised to battle them. There are 8 different diseases/causes considered, and each one is associated with a color. The sizes of the circles are proportional to the dollars raised for (on the left-hand side) and deaths caused by (on the right-hand side) the 8 diseases/causes. The infographics seems fine at first glance, but it suffers from the following problems:  
    
1. Similar to pie charts, it is visually difficult to see the relative difference among diseases in the same category (deaths or dollars); readers are left guessing the relative sizes of the circles.
2. Because the dollars and deaths are not aligned by diseases, it forces the reader to look at one disease at a time; it is very difficult to spot a pattern between the 2 categories by diseases. 
3. The data sources are inconsistent. The data source for deaths is for the year 2011 and the data sources for the money raised range from 2012 to 2014.  
  
I focused on improving 1 and 2. I used the data reported in the inforgraphics to create my own graphs in R. In total, four graphs were made. I used colors from "i want hue" for two of my graphs.   

```{r, warning=FALSE, message=FALSE, echo=FALSE,fig.width=8, fig.height=8}
library(png)
library(grid)
img <- readPNG("origFig.png")
grid.raster(img)
```

___
# Improvement with Stacked Bar Chart  
Stacked bar charts are a close cousin of pie charts. After all, in ggplot, stacked bar charts are only one line of code away from becoming a pie chart. Stacked bar charts are slightly less evil because it is visually easier to compare rectangles in a bar than slices in a circle. In interest of seeing the relative difference among diseases in each category, I made a stacked bar chart.  
  
As shown below, the stacked bar chart is not aesthetically pleasing (too much visual noise caused by too many categories). Also, it does not do a good job representing the data (uncertainty in values). I could have included the percent values of dollars or deaths within each rectangle, but that would have only resulted in a minor improvement. Plus, there are too many rectangles where it would have not been possible to include the percent values.  
  
There is one solid advantage over the original infographics. It is easy to tell from the stacked bar chart that breast cancer and prostate cancer combined constitute more than 75% of money raised, while they constitute less than 10% of deaths. This would have been difficult to glean from the original infographics. It is a small improvement.  

```{r, warning=FALSE, message=FALSE, echo=FALSE, fig.width=10, fig.height=5.5}
library(ggplot2)
library(dplyr)
library(tidyr)
library(grid)
cbPalette <- c("#F2A19D", "#74E3AF", "#E9C459", "#D4B9DF", "#8AD7DB", "#C4E670", "#B0D68F", "#DABC79")
df <- read.csv('originalBadData.txt',header = TRUE)
df <- df %>%
      mutate(ratio = Money.Raised /Deaths)
mf_labeller <- function(var, value){
  value <- as.character(value)
  if (var=="gathered") { 
    value[value=="Money.Raised"] <- "Money Raised"
    value[value=="Deaths"]   <- "Deaths (US)"
  }
  return(value)
}

stacked <- df %>%
  transform(Money.Raised = Money.Raised/sum(Money.Raised) * 100) %>%
  transform(Deaths = Deaths/sum(Deaths) * 100) %>%
  gather("gathered", "percent", Money.Raised, Deaths)

ggplot(stacked, aes(x=factor(1), y=percent, fill=factor(Diseases))) + 
  geom_bar(stat = 'identity', width = 0.75, color = "#4A4A4A") +
  facet_grid(~gathered, labeller=mf_labeller) +
  scale_fill_manual(values=cbPalette,
                    breaks=c("Breast Cancer", "Prostate Cancer", "Heart Disease", "Motor Neuron Disease (including ALS)", "HIV / AIDS", "Chronic Obstructive Pulmonary Disease", "Diabetes", "Suicide"),
                    labels=c("Breast Cancer", "Prostate Cancer", "Heart Disease", "Motor Neuron Disease \n(including ALS)", "HIV / AIDS", "Chronic Obstructive \nPulmonary Disease", "Diabetes", "Suicide")) + 
  ylab("Percent  %") +
  guides(shape=guide_legend(override.aes=list(size=10))) + 
  theme(strip.text.x = element_text(size = 22), 
        axis.text.x = element_blank(),
        axis.text.y = element_text(color="black",size=18,angle=0,hjust=1,vjust=0),  
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=20 ,angle=90,hjust=.5,vjust=.5),
        legend.title = element_blank(),
        legend.text = element_text(color="black",size=14),
        legend.key.size=unit(1.5,"line"))
```

___
# Improvement with Bar Chart (Faceting) 
Faceting is an alternative to stacked bar charts. Faceting involves spliting the data by a variable and plotting the grouped data together. In the ggplot2 documentation, it suggests using bar charts with faceting as an alternative to stacked bar charts.  
  
As shown below, the bar chart with faceting is a huge improvement over the two previous graphs, both in terms of aesthetics and data representation. It cleanly shows the relative difference among diseases in each category (money raised and deaths). Also, it is easier to compare the dollars and deaths for a certain disease. Unlike the stacked bar chart, it was easy to display the percent values with the bars, which reduces ambiguity. This is a strong candidate for replacing the original infographics.  

```{r, warning=FALSE, message=FALSE, echo=FALSE, fig.width=10, fig.height=5.5}
stacked$Diseases <- factor(stacked$Diseases, levels = c("Breast Cancer", "Prostate Cancer", "Heart Disease", "Motor Neuron Disease (including ALS)", "HIV / AIDS", "Chronic Obstructive Pulmonary Disease", "Diabetes", "Suicide"))

ggplot(stacked, aes(x =Diseases, y = percent, fill=factor(Diseases))) + 
  geom_bar(stat = 'identity', color = "#4A4A4A") +
  facet_grid(~ gathered, labeller=mf_labeller) + 
  scale_fill_manual(values=cbPalette,
                  breaks=c("Breast Cancer", "Prostate Cancer", "Heart Disease", "Motor Neuron Disease (including ALS)", "HIV / AIDS", "Chronic Obstructive Pulmonary Disease", "Diabetes", "Suicide"),
                  labels=c("Breast Cancer", "Prostate Cancer", "Heart Disease", "Motor Neuron Disease \n(including ALS)", "HIV / AIDS", "Chronic Obstructive \nPulmonary Disease", "Diabetes", "Suicide"))  +
  ylab("Percent  %") +
  guides(shape=guide_legend(override.aes=list(size=10))) +
  geom_text(aes(label=round(percent), vjust=-0.5)) + 
  theme(strip.text.x = element_text(size = 22), 
        axis.text.x = element_blank(),
        axis.text.y = element_text(color="black",size=18,angle=0,hjust=1,vjust=0),  
        axis.title.x = element_blank(),
        axis.title.y = element_text(size=20 ,angle=90,hjust=.5,vjust=.5),
        legend.title = element_blank(),
        legend.text = element_text(color="black",size=14),
        legend.key.size=unit(1.5,"line"))
```
___
# Improvement with Single Figure, Two Lines 
Another alternative to stacked bar charts, which is also suggested in the ggplot documentation, is to use a line instead of bars and plot the 2 categories (dollars and deaths) in the same figure. By plotting the data in one figure, the comparison between dollars and deaths by diseases is made visually easier to understand. Also, coloring was removed and tick labels were added (the colors were arbitually selected and had poor mapping to the diseases/causes). This is a design choice that I believe follows Tufte's rules of not using meaningless and unnecessary color scheme to represent data when labeling the axis would accomplish the same.  

This is also a strong candidate for replacing the original infographics. It does a better job comparing the 2 categories by diseases than the bar charts with faceting. I like how efficiently this minimalistic graph is able to convey the relevant information.  

```{r, warning=FALSE, message=FALSE, echo=FALSE,fig.width=10,fig.height=6.5}
levels(stacked$gathered)[levels(stacked$gathered)=="Money.Raised"] <- "Money Raised"

ggplot(stacked, aes(x=Diseases, y=percent, group = gathered)) +
  geom_line(aes(linetype=gathered), # Line type depends on cond
            size = 2) +       # Thicker line
  geom_point(aes(shape=gathered),   # Shape depends on cond
             fill = "white",
             size = 6.5)  +       # Large points
  scale_shape_manual(values=c(21,24)) +
  ylab("Percent  %") +
  scale_x_discrete(breaks=c("Breast Cancer", "Prostate Cancer", "Heart Disease", "Motor Neuron Disease (including ALS)", "HIV / AIDS", "Chronic Obstructive Pulmonary Disease", "Diabetes", "Suicide"),
                   labels=c("Breast Cancer", "Prostate Cancer", "Heart Disease", "Motor Neuron Disease\n(including ALS)", "HIV/AIDS", "Chronic Obstructive\nPulmonary Disease", "Diabetes", "Suicide")) +
  theme(strip.text.x = element_text(size = 22), 
      axis.text.x = element_text(color="black",size=16,angle=45,hjust=1),
      axis.text.y = element_text(color="black",size=18,angle=0,hjust=1,vjust=0),  
      axis.title.x = element_blank(),
      axis.title.y = element_text(size=20 ,angle=90,hjust=.5,vjust=.5),
      legend.title = element_blank(),
      legend.text = element_text(color="black",size=14),
      legend.key.size=unit(1.5,"line"))
```

___
# Improvement with Single Figure, Bar Chart
If we were merely intersted in comparing the dollars raised for and death tolls of diseases, we could easily find the ratio of dollars per deaths for each diseae and plot that data. This enables us to use a simple bar chart (or a line graph) to represent the infromation that I believe the author of the infographics wanted to convey. I am not a fan of this figure because it hides some of the information that were cleanly illustrated in the previous graph. However, this graph is better at emphaizing how money raised for combating diseases are not correlated with the death tolls. 

```{r, warning=FALSE, message=FALSE, echo=FALSE, fig.width=10, fig.height=5.5}
sortRatio <- df %>%
  transform(df, Diseases = reorder(Diseases, ratio))

ggplot(sortRatio, aes(x = Diseases, y = ratio)) + 
  geom_bar(stat = 'identity', aes(width = 0.7)) + 
  scale_x_discrete(breaks=c("Prostate Cancer", "Breast Cancer", "Motor Neuron Disease (including ALS)", "HIV / AIDS", "Heart Disease", "Suicide", "Diabetes", "Chronic Obstructive Pulmonary Disease"),
                   labels=c("Prostate Cancer", "Breast Cancer", "Motor Neuron Disease\n(including ALS)", "HIV / AIDS", "Heart Disease", "Suicide", "Diabetes", "Chronic Obstructive\nPulmonary Disease")) +
  coord_flip() +
  ylab("Ratio (Money Raised in Millions per Death)") + 
  theme(strip.text.x = element_text(size = 22), 
        axis.text.x = element_text(color="black",size=18),
        axis.text.y = element_text(color="black",size=16),  
        axis.title.x = element_text(size=20, vjust=-0.25),
        axis.title.y = element_blank(),
        legend.title = element_blank(),
        legend.text = element_text(color="black",size=14),
        legend.key.size=unit(1.5,"line"))
```

___
# What I learned...
1. How to convert wide data to long data using tidyr, which was essential for faceting. 
2. The limitation of stacked bar charts and how visual noise becomes a factor when there are more than 3 variables.
3. I presented 3 possible alternatives to the original infographics, but my favorite is the bar chart with faceting. This is a personal preference, and I think it has more to do with my academic background.  
4. More importantly, I learned the importance of visualizing the data in different ways. This made it easier for me to understand the strengths and weaknesses of different types of graphs. 